# Setup Guide

## Prerequisites

- [Bun](https://bun.sh) runtime
- [Figma](https://figma.com) desktop or web app
- An AI coding tool with MCP support (Claude Code, Cursor, etc.)

## 1. Install dependencies

```bash
bun install
bun run build
```

## 2. Generate SSL certificates

The WebSocket server requires TLS because Figma plugins run in an HTTPS context and browsers block mixed content (`wss://` not `ws://`).

```bash
mkdir -p certs
# Generate a self-signed cert (valid 365 days)
openssl req -x509 -newkey rsa:2048 -keyout certs/key.pem -out certs/cert.pem -days 365 -nodes -subj "/CN=localhost"
```

## 3. Start the WebSocket relay

This bridges the MCP server and the Figma plugin via channels.

```bash
SSL_KEY_PATH=certs/key.pem SSL_CERT_PATH=certs/cert.pem bun socket
```

You should see: `WebSocket server running on port 3056`

## 4. Install the Figma plugin

1. In Figma, go to **Plugins > Development > Import plugin from manifest...**
2. Select `plugin/manifest.json` from this repo (generated by `bun run build`)
3. Run the plugin — it will show a connection panel

## 5. Configure MCP in your AI tool

Add to your MCP config (e.g. `.cursor/mcp.json`, `.claude.json`, or `.mcp.json`):

```json
{
  "mcpServers": {
    "Vibma": {
      "command": "node",
      "args": ["dist/mcp.js"]
    }
  }
}
```

Or run from source (no build step, good for development):

```json
{
  "mcpServers": {
    "Vibma": {
      "command": "bun",
      "args": ["run", "src/mcp.ts"]
    }
  }
}
```

## 6. Connect

1. In the Figma plugin, optionally set a custom channel name (or leave blank for a random one)
2. Click **Connect** — note the channel name shown
3. In your AI tool, call `join_channel` with that channel name
4. Test with `get_document_info` — you should get back your Figma document structure

## Troubleshooting

**Plugin won't connect to WebSocket**: Make sure the SSL certs exist and the server is running with the `SSL_KEY_PATH` and `SSL_CERT_PATH` env vars set. The plugin connects to `wss://localhost:3056`.

**MCP shows disconnected**: Restart your AI tool after changing MCP config. Stdio-based MCP servers can't hot-reload.

**Port 3056 already in use**: Kill the existing process (`lsof -ti:3056 | xargs kill`) or set a different port with `PORT=3056`.
